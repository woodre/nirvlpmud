#!/bin/sh
cd pfiles
echo 'Number of active players: ' `../../count_active */*.o`
echo ""
echo 'List of top questing players ' `date`
echo ""
echo "Name      Lev    QuestPoints Age"
echo ""
#Inserted exclude directories, and added testchar_var to stop it from
#Adding test characters - Rumplemintz
egrep --exclude="*_LD*.o" '^level |^cap_name |^quest_point |^prestige_qp|^age |^testchar_var ' [d]/*.o |\
sed -e 's/\.o:/ /' -e 's/\"//g' |\
#sort -k1,1r -k2 |\
awk '
$2=="age" { age = $3; }
$2=="prestige_qp" { prestige_qp = $3; }
$2=="quest_point" { quest_point = $3; }
$2=="cap_name" { cname = $3; }
$2=="level" { level = $3; }
$2=="testchar_var" { 
if ((level < 20) && ($3 < 1))  printf("%-10s %2d %'"'"'14d %d\n", cname, level, quest_point+prestige_qp, age/30/60);
   level = 20; testchar_var = 0; age = 1; prestige_qp = 0; quest_point = 0; cname = "XX"; }' |\
#sort +1rn +2rn |\
#change for loafy
sort -k 2,2rn -k3,3rn |\
head -100

