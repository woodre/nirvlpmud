#!/bin/sh
cd pfiles
echo 'Number of active players: ' `../../count_active */*.o`
echo ""
echo 'List of top kills since June 22nd 2014 as of ' `date`
echo ""
echo "Name                   Exp  Mob"
echo ""
#Inserted exclude directories, and added testchar_var to stop it from
#Adding test characters - Rumplemintz
egrep --exclude="*_LD*.o" '^top_kill|^level |^cap_name |^testchar_var ' [a-z]/*.o |\
sed -e 's/\.o:/ /' -e 's/\"//g' -e 's/top_kill [(][{]\(.*\)[}][)]/top_kill \1/' |\
sort -k1,1r -k2 |\
awk '
$2=="cap_name" { name = $3; }
$2=="level" { level = $3; }
$2=="testchar_var" { testchar_var = $3; }
$2=="top_kill" {  
for(i=3; i<= NF; i++) {
  if ( i > 3 )
    tmp = tmp " " $i
  else
    tmp = $i
}
n = split( tmp, topkill, "," )
#print n
#for (i=0; ++i <= n; )
#  print i, topkill[i]
if ((level < 20) && (testchar_var < 1))  printf("%-15s %'"'"'10d  %-30s\n", name, topkill[1], topkill[2]);
   testchar_var = 0; age = 1; experience = 0; name = "XX"; }' |\
#sort +1rn +2rn |\
#change for loafy
sort -k 2,2rn -k3,3rn |\
head -25

