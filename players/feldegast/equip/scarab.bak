/*
File: scarab.c
Creator: Feldegast @ Nirvana
Date: 1/25/01
Description:
  This is the reward for solving the jungle island quest.  It is an
ac1 amulet with a small return and a heal that recharges after an
hour.  It can only be obtained the first time the player solves the
quest.
*/
/* cut CHARGETIME in half, make it fully heal player when used,
  and gave it "magical" dtype protection.  It is a one
  time quest item after so, so it should be nice.
  -Forbin 2004.12.02 */
#include "defs.h"

#define CHARGETIME 1800 /* Was 1 hour, cut to 30 minutes -Forbin */

inherit "/obj/armor.c";

int last_use;

void reset(int arg) {
  ::reset(arg);
  if(arg) return;
  set_name("scarab");
  set_short(HIG+"Scarab of Healing"+NORM);
  set_long("The scarab of healing has been cut from a piece of jade large\n"+
           "enough to fit in the palm of your hand.  It is an ancient relic\n"+
           "from the days of the Majiri empire and possesses a special magic\n"+
           "that can be "+BOLD+"use"+NORM+"d once an hour.\n");
  set_ac(1);
  set_params("magical",0,10,0); /* "magical" dtype protection -Forbin */
  set_type("amulet");
  set_weight(2);
  set_value(2500);
}

int is_charged() {
  return time() >= last_use + CHARGETIME;
}

void long(string str) {
  write(long_desc);
  if(!is_charged())
    write(HIB+"The scarab is charging.\n"+NORM);
}

void init() {
  ::init();
  add_action("cmd_use","use");
}

int cmd_use(string str) {
  if(!id(str)) {
    notify_fail("Use what?\n");
    return 0;
  }
  if(environment()!=this_player())
    return 0;
  if(!worn) {
    write("You must wear the scarab to use it.\n");
    return 1;
  }
  if(!is_charged()) {
    write("The scarab isn't done recharging yet.\n");
    return 1;
  }
  write("The scarab of healing imbues you with its healing power.\n");
  say(TPN+" uses the scarab of healing.\n");
  this_player()->heal_self(500); /* changed from 50 to totally heal player */
  last_use=time();
  return 1;
}

int is_heal() { return 1; }

int do_special(object owner) {
  if(this_player()) /* check added by verte 6.6.01 */
  if((int)this_player()->query_attrib("luc") > random(200)) {
    write((string)owner->query_name()+"'s scarab flashes, blinding you!\n");
    tell_object(owner,"Your scarab flashes, blinding "+TPN+" briefly!\n");
    return 2;
  }
}

string locker_arg() {
  return last_use+"";
}

void locker_init(string arg) {
  sscanf(arg,"%d",last_use);
}

generic_object() { return 1; } 

restore_thing(str) {
  restore_object(str);
  return 1;
}

save_thing(str) {
  save_object(str);
  return 1;
}
