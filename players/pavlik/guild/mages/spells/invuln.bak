#include "/players/pavlik/guild/mages/defs.h"
#include "/players/pavlik/guild/mages/include/spell_costs.h"
inherit "players/pavlik/guild/mages/inherit/spell";

reset(arg) {
  if(arg) return;
  set_verb("invuln");
  set_name("Minor Invulnrability");
  set_color_name(HIBLK+"Minor "+MAG+"Invulnrability"+NORM);
  set_level(6);
  set_school("evocation");
  set_sp_cost(INVULN_COST);
  set_cost_string(INVULN_COST + " sp");
  set_descrip(
	"Coming soon ... \n"
  );
}


spell()
{
  object ob;

  if(tp->query_real_name() != "pavlik" && tp->query_real_name() != "pavtest" &&
     tp->query_real_name() != "mortarion")
  {
	notify_fail("Sorry, this spell is still in alpha.\n");
	return 0;
  }

  if(!spell_cast())
	return 0;

  if(ob = shadow(tp, 0))
  {
	write("You "+MAG+"stop"+NORM+" the "+query_color_name()+" spell.\n");
	ob->end_spell();
	if(guild)
		guild->remove_spell_object("invuln");
  }
  else
  {
	write("You cast an " + query_color_name() + " spell ... \n");
	write("You feel a "+HIM+"shift"+NORM+" in your body as the "+query_color_name()+" spell goes into effect.\n");
	say(ME+" casts a "+HIC+"spell"+NORM+" and you feel the air tingle with "+HIM+"magic"+NORM+".\n");
	ob = clone_object(OBJ_DIR + "augury");
	ob->set_spell_name("invuln");
	ob->do_spell(tp);
	if(guild)
		guild->add_spell_object("invuln", ob);
	if(!present("mage_casting_object", tp))
		tp->add_spell_point(-query_sp_cost());
  }

  return 1;
}

