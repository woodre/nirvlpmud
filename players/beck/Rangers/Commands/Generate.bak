#include "/players/beck/Defs.h"
#include "/players/beck/Rangers/RangerDefs.h"

RangerPower(num ,string channel){
 
/*  Allows a player to convert spell points to guild power */

   int amount;
   int amount3;
   /* changed sscanf from %df to %d  3/99 Snow */
   if(!num) return 1;
   if(sscanf(num, "%d", amount) !=1) {
      write("Generate <spell points>\n");
      return 1;
   }
   if(amount < 5){
      write("You must convert at least 5 spell points at a time.\n");
      return 1;
   }
   if(TP->LEVEL > 19){
      write("Wizards may not donate power!\n");
      return 1;
   }
   if(TP->SP < amount){
      write("You don't have that many spell points.\n");
      return 1;
   }
   
   if(MASTER->QPowerPoints(channel) > 14999){
      write("The power is full.\n");
      return 1;
   }
   amount3 = amount;
   amount = amount - 20;
   amount += random(20);
   if(amount + MASTER->QPowerPoints(channel) > 14999){
      amount = 15000 - MASTER->QPowerPoints(channel);
      amount3 = 15000 - MASTER->QPowerPoints(channel);
   }

   if(amount < -5) amount = 0;
   if(amount < 0){
      amount = 1;
   }
   if(MASTER->APowerPoints(amount, channel))
      this_player()->add_spell_point(-amount3);
   else
      return 1;
   write("You generate "+amount+" Power Points for the guild.\n");
   return 1;

}

QMax(){
   return 1;
}

RangerInfo(str){
write("Generate allows you to convert spell points (SP) for power.\n"+
"The rate of conversion is not 1:1.\n\n");
return 1;
}

