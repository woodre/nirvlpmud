/******************************************************************************
 *  
 *  File:           fsword.c
 *  
 *  Author(s):      Vital@Nirvana
 *  
 *  Copyright:      Copyright (c) 2001 Vital@Nirvana
 *                  All Rights Reserved.
 *  
 *  Source:			Started 9/22/01.
 *  
 *  Notes:			
 *  
 *  Change History: 9/24/01,
 *  
 *  Update - Brittany 21/07/01
 *****************************************************************************/


#include "/players/brittany/ansi"
#define SWORD "Grayswandir"

inherit "obj/weapon.c";

int flame;
string *ids;

reset(arg) {
    flame = 0;
    ::reset(arg);
    if (arg) return;
    set_name("grayswandir");
    set_alias("A heavy sword");
    set_short(SWORD);
    set_long("\
  The long, thin blade "+BLINK+"s"+NORM+"h"+BLINK+"i"+NORM+"m"+BLINK+"m"+NORM+"e"+BLINK+"r"+NORM+"s before your eyes. The air around it \n\
seems warped and distorted by the intense "+RED+"heat"+NORM+" generated by the \n\
blade. The hilt of the sword is composed of some strange material \n\
that almost glows a light "+CYN+"blue"+NORM+".\n"
    );
    set_type("sword");
    set_id( ({
        name_of_weapon, alias_name, type, "blade"
    }) );
    set_class(16);
    set_weight(5);
    set_value(700+random(800));
    set_hit_func(this_object());
}

weapon_hit(attacker) {
    if(flame > 50) flame = 1;
    switch(random(100)) {
        case  0..29: flame++; break;
        case 30..49:
            say("The "+SWORD+" flares up and the heat intensifies.\n");
            write("The "+SWORD+" begins to cause you to sweat.\n");
            flame = flame + (100/(this_player()->query_attrib("sta")));
            break;
        case 50..69:
            if((attacker->query_hp()/attacker->query_mhp())*100 < 10) {
                say(this_player()->query_name()+" smiles evilly.\n");
                write("You smile evilly.\n");
                flame = attacker->query_hp();
            }
            break;
        case 70..84:
            say("The room seems to grow suddenly "+HIB+"cold"+NORM+".\n");
            write("The "+SWORD+" begins to cool and draws heat from the room around it.\n");
            this_player()->hit_player(random(10), "other|ice");
            flame = flame / this_player()->query_attrib("mag");
            break;
        case 85..95:
            say(this_player()->query_name()+" slashes about wildly with the "+SWORD+".\n");
            write("You feel the "+SWORD+" twist and turn in your hand.\n");
            flame = 1;
            break;
        case 96:
            say(HIR+"Fire"+NORM+" flashes in "+this_player()->query_name()+"'s eyes.\n");
            write("The fires of the "+SWORD+" begin to feed your soul's fire.\n");
            this_player()->add_spell_point(random(flame));
            flame - random(flame);
            break;
        case 97:
            say(this_player()->query_name()+" screams in pain and delight.\n");
            write("You writhe and scream in ecstasy as the "+SWORD+" swings around.\n");
            this_player()->command("say "+HIR+"Fire"+NORM+"!");
            flame = flame + (flame/this_player()->query_attrib("pie"));
            break;
        case 98:
            say("The air in the room begins to shimmer with the heat from the "+SWORD+".\n");
            write("The air around you is superheated from the "+SWORD+".\n");
            this_player()->add_spell_point(-5);
            this_player()->add_hit_point(5);
            flame = flame + random(10);
            break;
        case 99:
            say("The "+SWORD+" whistles through the superheated air of the room.\n");
            write("The "+SWORD+" whistles through the superheated air of the room.\n");
            flame = flame + 100/(this_player()->query_attrib("luc"));
            break;
    }
    if(flame && flame > this_player()->query_attrib("wil")) attacker->hit_player(random(flame), "other|fire");
    if(!random(3)) return 1;
    return 0;
}

id(string str) {
    if(!ids) ids = ({ });
    if(str == "hilt" || str == "handle" || str == "material") {
        return 1;
    }
    if(member_array(str, ids)) return (member_array(str, ids) >= 0);
}

set_id(string *new_ids) {
    ids = new_ids;
}

long(str) {
    if(!str) return 0;
    if(str == "hilt" || str == "handle" || str == "material") {
        write("The material in the hilt glows light blue and offsets the intense heat of the blade.\n"); 
        return;
    }
    if(member_array(str,ids)) write(long_desc);
    return;
}
