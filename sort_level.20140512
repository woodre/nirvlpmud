#!/bin/sh
cd pfiles
echo 'Number of active players: ' `../../count_active */*.o`
echo ""
echo 'List of top players ' `date`
echo ""
echo "Name      Lev Experience Age"
echo ""
#Inserted exclude directories, and added testchar_var to stop it from
#Adding test characters - Rumplemintz
egrep --exclude-dir=dumbasses \
      --exclude-dir=hacked \
      --exclude-dir=junk \
      --exclude-dir=misc \
      --exclude-dir=notes \
      --exclude-dir=STOR \
      --exclude-dir=suicide \
      --exclude-dir=suicide2 \
      '^level |^cap_name |^experience |^age |^testchar_var ' */*.o |\
sed -e 's/\.o:/ /' -e 's/\"//g' |\
sort |\
awk '
$2=="testchar_var" { testchar_var = $3; }
$2=="age" { age = $3; }
$2=="experience" { experience = $3; }
$2=="cap_name" { name = $3; }
$2=="level" { if (($3 < 20) && (testchar_var < 1))  printf("%-10s %2d %2d %d\n", name, $3, experience, age/30/60);
	    experience = 0; name = "XX"; }' |\
#sort +1rn +2rn |\
#change for loafy
sort -k 2,2rn -k3,3rn |\
head -20

